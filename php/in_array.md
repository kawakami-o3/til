# in_array の話

PHP5からPHP7になってin_arrayが速くなっているという話をソースを参照しながら掘り下げてみる。

ざっくり何が変わって速くなっているかを言ってしまうと、連想配列の実装が大きく変わったためによる。
PHP7のリリース前後に解説が多数でているので検索してみるとすぐに見つけることができる。
たとえば、 https://www.slideshare.net/hnw/php7-52408724 .

## PHP5とPHP7で計測

まず、以下のようなスクリプトで処理時間を計測してみる。

```php
<?php

//$n = 100000;
//$trial = 100;

$n = 100;
$trial = 100000;

$a = [];
for ($i=0 ; $i<$n ; $i++) {
    $a[] = $i;
}

$time = microtime(true);

$b = 0;
for ($i=0 ; $i<$trial ; $i++) {
    if (in_array($n/2, $a, true)) {
        $b ++;
    }
}

$result = microtime(true) - $time;

echo "{$result}\n";
```

手元の環境では

| バージョン | 時間(s) |
----|----
| 5.6.40 | 0.052852153778076 |
| 7.4.14 | 0.028527021408081 |

要素数が多いとより差が大きくなるが、2倍ほど速くなっていることがわかる。

## PHP5のin_array実装

## PHP7のin_array実装

## 比較実験


